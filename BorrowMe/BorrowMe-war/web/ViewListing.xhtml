<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="./template/defaultTemplate.xhtml"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="content">

        <p:layout>

            <p:layoutUnit size="300" position="east">
                <br/>

                <h:form>

                    <p:growl id="messages" showDetail="false"/>

                    <p:menu toggleable="true" style="height:100%; width:100%">
                        <p:submenu label="Ajax">
                            <p:menuitem value="Save"  update="messages" icon="ui-icon-disk" />
                            <p:menuitem value="Update" update="messages" icon="ui-icon-arrowrefresh-1-w"/>
                        </p:submenu>
                        <p:submenu label="Non-Ajax">
                            <p:menuitem value="Delete" update="messages" ajax="false" icon="ui-icon-close"/>
                        </p:submenu>
                        <p:submenu label="Navigations">
                            <p:menuitem value="External" url="http://www.primefaces.org" icon="ui-icon-home"/>
                            <p:menuitem value="Internal" outcome="/index" icon="ui-icon-star"/>
                        </p:submenu>
                    </p:menu>

                </h:form>

            </p:layoutUnit>

            <p:layoutUnit position="center" >

                <!--styleClass="ui-noborder"-->

                <p:panelGrid style="margin: 0 auto" >

                    <p:row>
                        <p:column colspan="2" >
                            <p:galleria value="#{viewListingManagedBean.listingToView.images}" var="image" panelWidth="313" panelHeight="313" showCaption="false">
                                <p:graphicImage value="#{image}"  alt="Image Description for #{image}" title="#{image}" style="height:100%; width:100%"/>
                            </p:galleria>
                        </p:column>
                        <p:column rowspan="2" style="vertical-align: top;">
                            <p:panelGrid style="height:100%; width:100%">
                                
                                <p:row>
                                    <p:column colspan="2">
                                        <h:outputText style="font-weight:bold; font-size:25px" value="#{viewListingManagedBean.listingToView.listingTitle}" />
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column>
                                        <p:graphicImage value="./images/defaultprofilepic.png" style="border-radius:100px; height:auto; 
                                                        width: auto; 
                                                        max-width: 50px; 
                                                        max-height: 50px;"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="by #{viewListingManagedBean.listingToView.customerEntity.username}"></h:outputText>

                                    </p:column>

                                </p:row>
                                <p:row>
                                    <p:column>
                                        <ui:include src="./images/description.svg" />&nbsp;
                                        <h:outputText value="Description:" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{viewListingManagedBean.listingToView.listingDescription}" />
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <ui:include src="./images/category.svg" />&nbsp;
                                        <h:outputText value="Category:" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{viewListingManagedBean.listingToView.category}" />
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column>
                                        <ui:include src="./images/price.svg" />&nbsp;
                                        <h:outputText value="Cost/day:" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column>
                                        <h:outputText value="#{viewListingManagedBean.listingToView.costPerDay}" />
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">
                                        <h:form>
                                            <p:commandButton value="Book Rental" onclick="PF('dialogRequest').show()" icon="ui-icon-key" />
                                        </h:form>

                                        <h:form>
                                            <p:commandButton value="View Requests" onclick="PF('dialogViewRequests').show()" icon="ui-icon-key" />
                                        </h:form>

                                    </p:column>

                                </p:row>
                            </p:panelGrid>
                        </p:column>

                    </p:row>

                    <p:row>
                        <p:column  width="50%"><h:outputText value="Title:" style="font-weight:bold"/></p:column>
                        <p:column width="50%"> <h:outputText value="#{viewListingManagedBean.listingToView.listingTitle}" /></p:column>


                    </p:row>

                </p:panelGrid>

                <h:form id="formRequest">

                    <p:dialog id="dialogRequest" widgetVar="dialogRequest" header="Make Rental Request" closable="true">

                        <p:messages id="messagesRequest" redisplay="false" />

                        <p:panelGrid rendered="#{sessionScope['isLogin']}">

                            <p:row>
                                <p:column>
                                    <p:outputLabel for="startdate" value="Start Date: " />
                                </p:column>
                                <p:column>
                                    <p:calendar id="startdate" value="#{viewListingManagedBean.newStartDate}" >
                                        <p:ajax event="dateSelect" update="noOfDays" listener="#{viewListingManagedBean.dateDiff}" />
                                    </p:calendar>
                                </p:column>
                                <p:column>
                                    <p:message for="startdate" />
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel for="enddate" value="End Date: " />
                                </p:column>
                                <p:column>
                                    <p:calendar id="enddate" value="#{viewListingManagedBean.newEndDate}" >
                                        <p:ajax event="dateSelect" update="noOfDays" listener="#{viewListingManagedBean.dateDiff}" />
                                    </p:calendar>
                                </p:column>
                                <p:column>
                                    <p:message for="enddate" />
                                </p:column>
                            </p:row>

                            <p:row>
                                <p:column>
                                    <p:outputLabel for="noOfDays" value="Day(s) Rental: " />
                                </p:column>
                                <p:column>
                                    <p:outputLabel id="noOfDays" value="#{viewListingManagedBean.dateDiffValue}" />
                                </p:column>
                                <p:column>
                                    <p:message for="noOfDays" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column>
                                    <p:outputLabel for="message" value="Message:" />
                                </p:column>
                                <p:column>
                                    <p:inputText id="message" value="#{viewListingManagedBean.newRequestEntity.message}" required="true" requiredMessage="Message is required" />
                                </p:column>
                                <p:column>
                                    <p:message for="message" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column colspan="3">
                                    <p:commandButton type="reset" value="Clear" />&nbsp;
                                    <p:commandButton value="Make Rental Request!" update="@form" actionListener="#{viewListingManagedBean.createRequest}" oncomplete="PF('dialogRequest').show();" />
                                </p:column>
                            </p:row>

                        </p:panelGrid>

                        <p:panelGrid  rendered="#{!sessionScope['isLogin']}">
                            <p:outputLabel value="NOT LOGGED IN!!!!!"></p:outputLabel>
                        </p:panelGrid>

                    </p:dialog>

                </h:form>


                <h:form id="formViewRequests">

                    <p:dialog id="dialogViewRequests" widgetVar="dialogViewRequests" header="View Requests" closable="true">

                        <p:messages id="messages" redisplay="false" closable="true" />

                        <p:dataTable id="dataTableAllRequests" widgetVar="dataTableAllRequests" value="#{viewListingManagedBean.requests}" var="requestEntity" rowKey="#{requestEntity.requestEntityId}" rowIndexVar="row"
                                     filteredValue="#{viewListingManagedBean.filteredRequests}"
                                     rows="10" paginator="true" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="10,20,50">

                            <f:facet name="header">
                                <p:outputPanel style="text-align: right;">
                                    <h:outputText value="Search all fields:" />
                                    <p:inputText id="globalFilter" onkeyup="PF('dataTableAllRequests').filter()" style="width:300px" placeholder="Enter keyword"/>
                                </p:outputPanel>
                            </f:facet>

                            <p:column headerText="Request ID" sortBy="#{requestEntity.requestEntityId}" filterBy="#{requestEntity.requestEntityId}" filterMatchMode="contains">
                                <h:outputText value="#{requestEntity.requestEntityId}" />
                            </p:column>

                            <p:column headerText="Requester:" sortBy="#{requestEntity.customerEntity.username}" filterBy="#{requestEntity.customerEntity.username}" filterMatchMode="contains">
                                <h:outputText value="#{requestEntity.customerEntity.username}" />
                            </p:column>

                            <p:column headerText="Start Date:" sortBy="#{requestEntity.startDate}" filterBy="#{requerstEntity.startDate}" filterMatchMode="contains">
                                <h:outputText value="#{requestEntity.startDate}" style="text-align: center;">
                                    <f:convertDateTime type="both" pattern="dd-MM-YYYY"/>
                                </h:outputText>
                            </p:column>

                            <p:column headerText="End Date:" sortBy="#{requestEntity.endDate}" filterBy="#{requestEntity.endDate}" filterMatchMode="contains">
                                <h:outputText value="#{requestEntity.endDate}" >
                                    <f:convertDateTime type="both" pattern="dd-MM-YYYY"/>
                                </h:outputText>
                            </p:column>

                            <p:column headerText="Message:" sortBy="#{requestEntity.message}" filterBy="#{requestEntity.message}" filterMatchMode="contains">
                                <h:outputText value="#{requestEntity.message}" />
                            </p:column>

                            <p:column headerText="Action" >
                                <p:selectBooleanButton  id="approval"  value="#{viewListingManagedBean.accepted}" onLabel="Accepted" offLabel="Rejected" onIcon="ui-icon-check" offIcon="ui-icon-close">
                                </p:selectBooleanButton>
                            </p:column>

                        </p:dataTable>


                    </p:dialog>

                </h:form>

            </p:layoutUnit>

        </p:layout>

    </ui:define>

</ui:composition>
